<div class="content-wrap" ng-controller="inventoryTransferController">
    <div class="panel panel-default">
        <panel_heading_search bind-ui="kendoGrid">
            <div class="panel-group">
                <label>调拨开始时间:</label>
                <wms-Date-Time-Picker id="startTime" is-query="true" format="yyyy/MM/dd 00:00:00"/>
            </div>
            <div class="panel-group">
                <label>调拨结束时间:</label>
                <wms-Date-Time-Picker id="endTime" is-query="true" format="yyyy/MM/dd 23:59:59" />
            </div>
            <div class="panel-group">
                <label>调拨单号:</label><input type="text" ng-model="query.id" class="js_wms_number" />
            </div>
            <div class="panel-group">
                <label>单据类型</label>
                <!--<input type="text" name="typeCode" id="typeCode">-->
                <div class="panel-select">
                    <l-select src="AllocationType" name="query.typeCode" id="query.typeCode"></l-select>
                </div>
            </div>
            <div class="panel-group">
                <label>单据状态</label>
                <!--<input type="text" name="typeCode" id="typeCode">-->
                <div class="panel-select">
                    <l-select src="TicketStatus" name="query.statusCode" id="query.statusCode"></l-select>
                </div>
            </div>
            <div class="panel-group">
                <label>创建人:</label>
                <input type="text" name="query.createUser" ng-model="query.createUser"/>
            </div>
        </panel_heading_search>
        <div class="panel-body">
            <div kendo-grid="kendoGrid" options="mainGridOptions">
                <div k-detail-template>
                    <kendo-tabstrip>
                        <ul>
                            <li class="k-state-active">商家调拨明细</li>
                        </ul>

                        <div>
                            <div kendo-grid="transferDetailGrid" options="transferDetailOptions(dataItem)">

                                <!--<wms-import url="inventory/transfer/import" template-name="调拨单明细导入模板" title="商家调拨导入"/>-->
                                <div id="importWindow" kendo-window="importWindow" k-visible="false" k-resizable="false"></div>

                                <script type="text/x-kendo-template" id="J_fileForm">
                                    <form class="clearfix" method="post" enctype="multipart/form-data">
                                        <div class="import-container clearfix">
                                            <div class="clearfix">
                                                <div class="import-rol dl-btn">
                                                    <a href="/download/template/调拨单明细导入模板" class="btn mb-download">
                                                        <i class="fa fa-download faIcon">模板下载</i>
                                                    </a>
                                                </div>
                                                <div class="import-rol">
                                                    <span class="upFile">
                                                        选择导入文件<input class="files" type="file" name="file" nv-file-select="" uploader="uploader"
                                                                     accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/>
                                                    </span>
                                                    <p class="import-file-name" ng-bind="fileName"></p>
                                                </div>
                                                <div class="import-rol m-l-15">
                                                    <button class="btn import-btn" type="button" value="上传文件" ng-click="uploadFile()" ng-disabled="!uploader.getNotUploadedItems().length">
                                                        <i class="fa fa-upload faIcon"></i>导入
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="import-error upFilesTest js_operationResult" style="display: none">
                                        <div class="ie-header"><i class="fa fa-exclamation-circle faIcon"></i>异常结果</div>
                                        <div kendo-grid="importListGrid" id="importListGrid" options="importGridOptions">
                                        </div>
                                    </div>
                                </script>

                            </div>
                        </div>

                    </kendo-tabstrip>
                </div>
            </div>
        </div>

        <div kendo-window="skuPopup" k-title="'SKU'" k-model="true"
             k-resizable="false"
             k-width="630" k-height="400" k-visible="false"
             k-content="{ url: './tmpl/popup/sku.html' }"></div>

        <div kendo-window="locationPopup" k-title="'货位'" k-model="true"
             k-resizable="false"
             k-width="630" k-height="400" k-visible="false"
             k-content="{url: './tmpl/popup/location.html' }"></div>

    </div>
</div>

<script id="form-add" type="text/x-kendo-template">
    <div class="edit-form-container">
        <div class="window-form clearfix">
            <div class="pure-control-group p-b-5 pure-5">
                <label>调拨单号</label>
                <input type="text" disabled="disabled" value="自动生成">
            </div>
            <div class="pure-control-group p-b-5 pure-5">
                <label>单据类型</label>
                <!--<input type="text" name="typeCode" id="typeCode">-->
                <div class="panel-select">
                    <l-select src="AllocationType" name="typeCode" id="typeCode" ng-change="changeAllocationType(dataItem)" required></l-select>
                </div>
            </div>
            <!--<div class="pure-control-group p-b-5 pure-5">-->
                <!--<label>关联单号</label>-->
                <!--<input type="text" name="referNo" id="referNo">-->
            <!--</div>-->

            <div class="pure-control-group p-b-5 pure-5">
                <label>来源商家:</label>
                <div class="panel-select">
                    <wms-ui-select ui-select-name="fromStorerId" ui-select-id="fromStorerId" src="storer" on-select=fromStorerIdChange($item,$model)></wms-ui-select>
                </div>
            </div>
            <div class="pure-control-group p-b-5 pure-5">
                <label>目标商家:</label>
                <div class="panel-select">
                    <wms-ui-select ui-select-name="toStorerId" ui-select-id="toStorerId" src="storer" on-select=toStorerIdChange($item,$model)></wms-ui-select>
                </div>
            </div>
            <div class="pure-control-group p-b-5 pure-5" ng-hide="allocationTypeDisable" >
                <label>是否生成反向调拨单</label>
                <span class="child-span">
                    <input type="checkbox" id="isReverse" name="isReverse" ng-model="isReverse"/>
                </span>
            </div>
            <div class="pure-control-group p-b-5 pure-5" ng-hide="allocationTypeDisable" >
                <label>提醒日期</label>
                <wms-Date-Time-Picker id="noticeTime" format="yyyy/MM/dd 00:00:00" />
            </div>
            <div class="pure-control-group p-b-5 ">
                <label class="panel-label-left">备注</label>
                <textarea class="tear-text" role="20" cols="50" id="memo" name="memo"></textarea>
            </div>
        </div>
    </div>
</script>

<script id="transferDetail-editor" type="text/x-kendo-template">
    <div class="edit-form-container">
        <div class="window-form">
            <div class="clearfix">
                <wms-popup-input data-type="location" data-prefix="from" data-item="dataItem"
                                 data-label="来源货位" data-errorMsg="请输入合法的货位号!" data-popup="$parent.locationPopup"
                                 validate-value-fn="validateFromLocationValue($event)" data-required="required"></wms-popup-input>
                <wms-popup-input data-type="location" data-prefix="to" data-item="dataItem"
                                 data-label="目的货位" data-errorMsg="请输入合法的货位号!" data-popup="$parent.locationPopup"
                                 validate-value-fn="validateToLocationValue($event)" data-required="required"></wms-popup-input>
                <wms-popup-input data-type="sku" data-item="dataItem" data-label="商品条码" window-open-fn="windowOpen($parent.dataItem)"
                                 data-errorMsg="请输入合法的商品条码!" data-popup="$parent.skuPopup" validate-value-fn="checkSkuBarcode(dataItem)" data-required="required"></wms-popup-input>
                <div class="pure-control-group p-b-5 pure-5">
                    <label>商品名称</label>
                    <input type="hidden" name="barcode" id="barcode" />
                    <input type="text" name="skuItemName" id="skuItemName"/>
                </div>
                <div class="pure-control-group p-b-5 pure-5">
                    <label>调拨数量</label>
                    <input type="text" name="transferQty" id="transferQty" required />
                    <input type="hidden" name="activeQty" id="activeQty"/>
                </div>
            </div>
        </div>
    </div>
</script>